<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶ó‡¶£‡¶ø‡¶§ ‡¶°‡¶ø‡¶™‡¶æ‡¶∞‡ßç‡¶ü‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏‡¶∞‡ßÅ‡¶ü‡¶ø‡¶®</title>
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #f0f2f5; padding: 10px; margin: 0; }
        .container { max-width: 500px; margin: 15px auto; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: #1a73e8; margin-bottom: 15px; font-size: 22px; }

        /* ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶Ü‡¶ß‡ßÅ‡¶®‡¶ø‡¶ï ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶≤‡¶ø‡¶Ç ‡¶è‡¶®‡¶ø‡¶Æ‡ßá‡¶∂‡¶® */
        .marquee-container { width: 100%; overflow: hidden; white-space: nowrap; background-color: #fff; padding: 10px 0; border-bottom: 1px solid #eee; display: flex; align-items: center; }
        .blink-label { color: red; font-weight: bold; animation: blinker 1s linear infinite; margin-right: 10px; flex-shrink: 0; }
        @keyframes blinker { 50% { opacity: 0; } }
        
        .marquee-text { display: inline-block; padding-left: 100%; animation: scroll-left 20s linear infinite; color: #d32f2f; font-weight: 500; font-size: 16px; }
        @keyframes scroll-left { 0% { transform: translateX(0%); } 100% { transform: translateX(-100%); } }

        .day-info { text-align: center; color: #2e7d32; font-size: 17px; font-weight: bold; margin: 15px 0; }
        .alert-box { background: #feebeb; color: #d93025; padding: 12px; border-radius: 8px; margin-bottom: 15px; border-left: 5px solid #d93025; text-align: center; font-weight: bold; display: none; }
        
        select { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #ccc; margin-bottom: 20px; font-size: 16px; background: #fff; }
        
        .card { background: #fff; border: 1px solid #e0e0e0; padding: 15px; margin-bottom: 12px; border-left: 6px solid #1a73e8; border-radius: 10px; }
        .time { color: #e65100; font-weight: bold; font-size: 14px; display: block; margin-bottom: 5px; }
        .subject { font-size: 18px; font-weight: bold; color: #202124; }
        .teacher { color: #5f6368; font-size: 14px; margin-top: 5px; }
        #loading { text-align: center; color: #666; margin-top: 50px; }
    </style>
</head>
<body>

<div id="loading">‡¶∞‡ßÅ‡¶ü‡¶ø‡¶® ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>

<div class="container" id="mainContainer" style="display:none;">
    <h2>‡¶ó‡¶£‡¶ø‡¶§ ‡¶°‡¶ø‡¶™‡¶æ‡¶∞‡ßç‡¶ü‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏‡¶∞‡ßÅ‡¶ü‡¶ø‡¶®</h2>
    
    <div id="noticeWrapper" class="marquee-container" style="display:none;">
        <span class="blink-label">üö® ‡¶¨‡¶ø‡¶∂‡ßá‡¶∑ ‡¶®‡ßã‡¶ü‡¶ø‡¶∂:</span>
        <div class="marquee-text" id="scrollingNotice"></div>
    </div>

    <div class="day-info" id="dayDisplay"></div>
    <div id="alertBox" class="alert-box"></div>

    <select id="yearSelect" onchange="renderRoutine()">
        <option value="">--‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶∞‡ßç‡¶∑ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®--</option>
        <option value="1st">‡ßß‡¶Æ ‡¶¨‡¶∞‡ßç‡¶∑ (1st Year)</option>
        <option value="2nd">‡ß®‡ßü ‡¶¨‡¶∞‡ßç‡¶∑ (2nd Year)</option>
        <option value="3rd">‡ß©‡ßü ‡¶¨‡¶∞‡ßç‡¶∑ (3rd Year)</option>
        <option value="4th">‡ß™‡¶∞‡ßç‡¶• ‡¶¨‡¶∞‡ßç‡¶∑ (4th Year)</option>
        <option value="1M">‡¶Æ‡¶æ‡¶∏‡ßç‡¶ü‡¶æ‡¶∞‡ßç‡¶∏ ‡¶™‡ßç‡¶∞‡¶ø‡¶≤‡¶ø (1M)</option>
        <option value="2M">‡¶Æ‡¶æ‡¶∏‡ßç‡¶ü‡¶æ‡¶∞‡ßç‡¶∏ ‡¶∂‡ßá‡¶∑ ‡¶¨‡¶∞‡ßç‡¶∑ (2M)</option>
    </select>

    <div id="routineList"></div>
</div>

<script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbz3Q2enjiQyWlmUiRj6sRrl1R_5B9XrVTT7WKXPlZpOUY35uUlxLiNrk9snMcKyW015/exec'; 
    let allData = {};
    let activeRestriction = null;

    async function fetchData() {
        try {
            const response = await fetch(scriptURL);
            allData = await response.json();
            setupApp();
        } catch (e) {
            document.getElementById('loading').innerText = "‡¶®‡ßá‡¶ü‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶ï ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ!";
        }
    }

   // ‡ßß. ‡¶∏‡¶Æ‡ßü‡¶ï‡ßá ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡ßü (‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü‡ßá) ‡¶∞‡ßÇ‡¶™‡¶æ‡¶®‡ßç‡¶§‡¶∞ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶∏‡ßç‡¶Æ‡¶æ‡¶∞‡ßç‡¶ü ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
    function timeToMinutes(timeStr) {
        if (!timeStr) return null;
        // ‡¶∏‡¶Æ‡ßü ‡¶•‡ßá‡¶ï‡ßá ‡¶ò‡¶£‡ßç‡¶ü‡¶æ, ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü ‡¶è‡¶¨‡¶Ç AM/PM ‡¶Ü‡¶≤‡¶æ‡¶¶‡¶æ ‡¶ï‡¶∞‡¶æ
        const match = timeStr.match(/(\d+):?(\d+)?\s*(AM|PM)?/i);
        if (!match) return null;
        
        let hours = parseInt(match[1]);
        let minutes = match[2] ? parseInt(match[2]) : 0;
        let ampm = match[3] ? match[3].toUpperCase() : null;

        // ‡¶Ø‡¶¶‡¶ø AM/PM ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡ßá (‡¶Ø‡ßá‡¶Æ‡¶® ‡¶∞‡ßÅ‡¶ü‡¶ø‡¶®‡ßá‡¶∞ ‡¶∏‡¶Æ‡ßü‡¶ó‡ßÅ‡¶≤‡ßã‡¶§‡ßá ‡¶®‡ßá‡¶á)
        if (!ampm) {
            // ‡ßØ ‡¶•‡ßá‡¶ï‡ßá ‡ßß‡ßß ‡¶π‡¶≤‡ßá ‡¶∏‡¶ï‡¶æ‡¶≤, ‡ßß ‡¶•‡ßá‡¶ï‡ßá ‡ß¨ ‡¶π‡¶≤‡ßá ‡¶¶‡ßÅ‡¶™‡ßÅ‡¶∞/‡¶¨‡¶ø‡¶ï‡¶æ‡¶≤ (‡ßß‡ß® ‡¶ò‡¶£‡ßç‡¶ü‡¶æ ‡¶Ø‡ßã‡¶ó ‡¶π‡¶¨‡ßá)
            if (hours >= 1 && hours < 7) hours += 12; 
        } else {
            // AM/PM ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶∏‡ßá‡¶ü‡¶æ‡¶ï‡ßá ‡ß®‡ß™ ‡¶ò‡¶£‡ßç‡¶ü‡¶æ‡¶∞ ‡¶´‡¶∞‡¶Æ‡ßá‡¶ü‡ßá ‡¶®‡ßá‡ßü‡¶æ
            if (hours === 12) hours = (ampm === "AM") ? 0 : 12;
            else if (ampm === "PM") hours += 12;
        }
        return hours * 60 + minutes;
    }

    // ‡ß®. ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶∏‡ßá‡¶ü‡¶Ü‡¶™ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
    function setupApp() {
        document.getElementById('loading').style.display = 'none';
        document.getElementById('mainContainer').style.display = 'block';

        const now = new Date();
        const days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
        document.getElementById('dayDisplay').innerText = `${days[now.getDay()]}, ${now.getDate()}.${now.getMonth()+1}.${now.getFullYear()}`;

        if (allData.specialNotice) {
            document.getElementById('noticeWrapper').style.display = 'flex';
            document.getElementById('scrollingNotice').innerText = allData.specialNotice;
        }

        const todayKey = `${now.getMonth() + 1}/${now.getDate()}/${now.getFullYear()}`;
        const alertRow = allData.alerts.find(row => {
            const d = new Date(row[0]);
            return `${d.getMonth() + 1}/${d.getDate()}/${d.getFullYear()}` === todayKey && row[1].toLowerCase() === "yes";
        });

        if (alertRow) {
            document.getElementById('alertBox').style.display = 'block';
            document.getElementById('alertBox').innerHTML = `‚ö†Ô∏è ${alertRow[3]}`;
            // ‡¶∞‡ßá‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø‡¶ï‡¶∂‡¶® ‡¶ü‡¶æ‡¶á‡¶Æ ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ
            activeRestriction = alertRow[2] || null;
        }
    }

    // ‡ß©. ‡¶∞‡ßÅ‡¶ü‡¶ø‡¶® ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶ß‡¶æ‡¶® ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® (‡¶ü‡¶æ‡¶á‡¶Æ ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞‡¶∏‡¶π)
    function renderRoutine() {
        const year = document.getElementById('yearSelect').value;
        const list = document.getElementById('routineList');
        list.innerHTML = "";
        if (!year) return;

        const dayName = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"][new Date().getDay()];
        let currentDay = "";
        
        // ‡¶∞‡ßá‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø‡¶ï‡¶∂‡¶® ‡¶ü‡¶æ‡¶á‡¶Æ‡¶ï‡ßá ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü‡ßá ‡¶∞‡ßÇ‡¶™‡¶æ‡¶®‡ßç‡¶§‡¶∞ (‡¶Ø‡ßá‡¶Æ‡¶®: 9:00 AM = 540 ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü)
        const limitMin = activeRestriction ? timeToMinutes(activeRestriction) : null;

        const filtered = allData.routine.filter((row, index) => {
            if (index === 0) return false;
            if (row[0]) currentDay = row[0].trim();
            return currentDay === dayName && String(row[2]) === year;
        });

        let count = 0;
        filtered.forEach(row => {
            // ‡¶∞‡ßÅ‡¶ü‡¶ø‡¶®‡ßá‡¶∞ ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏‡ßá‡¶∞ ‡¶∂‡ßÅ‡¶∞‡ßÅ‡¶∞ ‡¶∏‡¶Æ‡ßü (‡¶Ø‡ßá‡¶Æ‡¶®: 11:15)
            const classStartTimeStr = row[1].split('-')[0].trim();
            const classMin = timeToMinutes(classStartTimeStr);

            // ‡¶Æ‡ßÇ‡¶≤ ‡¶≤‡¶ú‡¶ø‡¶ï: ‡¶Ø‡¶¶‡¶ø ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏‡ßá‡¶∞ ‡¶∏‡¶Æ‡ßü ‡¶∞‡ßá‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø‡¶ï‡¶∂‡¶® ‡¶∏‡¶Æ‡ßü‡ßá‡¶∞ ‡¶∏‡¶Æ‡¶æ‡¶® ‡¶¨‡¶æ ‡¶¨‡ßá‡¶∂‡¶ø ‡¶π‡ßü, ‡¶§‡¶¨‡ßá ‡¶∏‡ßá‡¶ü‡¶ø ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá ‡¶®‡¶æ
            if (limitMin !== null && classMin !== null && classMin >= limitMin) {
                return; // ‡¶è‡¶á ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏‡¶ü‡¶ø ‡¶¨‡¶æ‡¶¶
            }

            count++;
            list.innerHTML += `
                <div class="card">
                    <span class="time">‚è∞ ‡¶∏‡¶Æ‡ßü: ${row[1]}</span>
                    <div class="subject">üìö ${row[3] || 'General Class'}</div>
                    <div class="teacher">üë®‚Äçüè´ ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶ï: ${row[4] || 'N/A'}</div>
                </div>`;
        });

        if (count === 0) {
            list.innerHTML = `<p style="text-align:center; color:#666; padding:20px;">${activeRestriction ? "‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶è‡¶á ‡¶∏‡¶Æ‡ßü‡ßá‡¶∞ ‡¶™‡¶∞‡ßá‡¶∞ ‡¶∏‡¶¨ ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏ ‡¶∏‡ßç‡¶•‡¶ó‡¶ø‡¶§ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§" : "‡¶Ü‡¶ú ‡¶ï‡ßã‡¶®‡ßã ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏ ‡¶®‡ßá‡¶á‡•§"}</p>`;
        }
    }

    fetchData(); // ‡¶è‡¶ü‡¶ø ‡¶∏‡¶¨‡¶æ‡¶∞ ‡¶∂‡ßá‡¶∑‡ßá ‡¶•‡¶æ‡¶ï‡¶¨‡ßá

</script>
</body>
</html>


