<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶ó‡¶£‡¶ø‡¶§ ‡¶°‡¶ø‡¶™‡¶æ‡¶∞‡ßç‡¶ü‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏‡¶∞‡ßÅ‡¶ü‡¶ø‡¶®</title>
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #f0f2f5; padding: 10px; margin: 0; }
        .container { max-width: 500px; margin: 15px auto; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: #1a73e8; margin-bottom: 15px; font-size: 22px; }

        /* ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶Ü‡¶ß‡ßÅ‡¶®‡¶ø‡¶ï ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶≤‡¶ø‡¶Ç ‡¶è‡¶®‡¶ø‡¶Æ‡ßá‡¶∂‡¶® */
        .marquee-container { width: 100%; overflow: hidden; white-space: nowrap; background-color: #fff; padding: 10px 0; border-bottom: 1px solid #eee; display: flex; align-items: center; }
        .blink-label { color: red; font-weight: bold; animation: blinker 1s linear infinite; margin-right: 10px; flex-shrink: 0; }
        @keyframes blinker { 50% { opacity: 0; } }
        
        .marquee-text { display: inline-block; padding-left: 100%; animation: scroll-left 25s linear infinite; color: #d32f2f; font-weight: 500; font-size: 16px; }
        @keyframes scroll-left { 0% { transform: translateX(0%); } 100% { transform: translateX(-100%); } }

        .day-info { text-align: center; color: #2e7d32; font-size: 17px; font-weight: bold; margin: 15px 0; }
        .alert-box { background: #feebeb; color: #d93025; padding: 12px; border-radius: 8px; margin-bottom: 15px; border-left: 5px solid #d93025; text-align: center; font-weight: bold; display: none; }
        
        select { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #ccc; margin-bottom: 20px; font-size: 16px; background: #fff; }
        
        .card { background: #fff; border: 1px solid #e0e0e0; padding: 15px; margin-bottom: 12px; border-left: 6px solid #1a73e8; border-radius: 10px; }
        .time { color: #e65100; font-weight: bold; font-size: 14px; display: block; margin-bottom: 5px; }
        .subject { font-size: 18px; font-weight: bold; color: #202124; }
        .teacher { color: #5f6368; font-size: 14px; margin-top: 5px; }
        #loading { text-align: center; color: #666; margin-top: 50px; }
    </style>
</head>
<body>

<div id="loading">‡¶∞‡ßÅ‡¶ü‡¶ø‡¶® ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>

<div class="container" id="mainContainer" style="display:none;">
    <h2>‡¶ó‡¶£‡¶ø‡¶§ ‡¶°‡¶ø‡¶™‡¶æ‡¶∞‡ßç‡¶ü‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏‡¶∞‡ßÅ‡¶ü‡¶ø‡¶®</h2>
    
    <div id="noticeWrapper" class="marquee-container" style="display:none;">
        <span class="blink-label">üö® ‡¶¨‡¶ø‡¶∂‡ßá‡¶∑ ‡¶®‡ßã‡¶ü‡¶ø‡¶∂:</span>
        <div class="marquee-text" id="scrollingNotice"></div>
    </div>

    <div class="day-info" id="dayDisplay"></div>
    <div id="alertBox" class="alert-box"></div>

    <select id="yearSelect" onchange="renderRoutine()">
        <option value="">--‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶∞‡ßç‡¶∑ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®--</option>
        <option value="1st">‡ßß‡¶Æ ‡¶¨‡¶∞‡ßç‡¶∑ (1st Year)</option>
        <option value="2nd">‡ß®‡ßü ‡¶¨‡¶∞‡ßç‡¶∑ (2nd Year)</option>
        <option value="3rd">‡ß©‡ßü ‡¶¨‡¶∞‡ßç‡¶∑ (3rd Year)</option>
        <option value="4th">‡ß™‡¶∞‡ßç‡¶• ‡¶¨‡¶∞‡ßç‡¶∑ (4th Year)</option>
        <option value="1M">‡¶Æ‡¶æ‡¶∏‡ßç‡¶ü‡¶æ‡¶∞‡ßç‡¶∏ ‡¶™‡ßç‡¶∞‡¶ø‡¶≤‡¶ø (1M)</option>
        <option value="2M">‡¶Æ‡¶æ‡¶∏‡ßç‡¶ü‡¶æ‡¶∞‡ßç‡¶∏ ‡¶∂‡ßá‡¶∑ ‡¶¨‡¶∞‡ßç‡¶∑ (2M)</option>
    </select>

    <div id="routineList"></div>
</div>

<script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbz3Q2enjiQyWlmUiRj6sRrl1R_5B9XrVTT7WKXPlZpOUY35uUlxLiNrk9snMcKyW015/exec'; 
    let allData = {};
    let activeRestriction = null;

    async function fetchData() {
        try {
            const response = await fetch(scriptURL);
            allData = await response.json();
            setupApp();
        } catch (e) {
            document.getElementById('loading').innerText = "‡¶®‡ßá‡¶ü‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶ï ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ!";
        }
    }

    function setupApp() {
        document.getElementById('loading').style.display = 'none';
        document.getElementById('mainContainer').style.display = 'block';

        const now = new Date();
        const days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
        document.getElementById('dayDisplay').innerText = `${days[now.getDay()]}, ${now.getDate()}.${now.getMonth()+1}.${now.getFullYear()}`;

        if (allData.specialNotice) {
            document.getElementById('noticeWrapper').style.display = 'flex';
            document.getElementById('scrollingNotice').innerText = allData.specialNotice;
        }

        const todayKey = `${now.getMonth() + 1}/${now.getDate()}/${now.getFullYear()}`;
        const alertRow = allData.alerts.find(row => {
            const d = new Date(row[0]);
            return `${d.getMonth() + 1}/${d.getDate()}/${d.getFullYear()}` === todayKey && row[1].toLowerCase() === "yes";
        });

        if (alertRow) {
            document.getElementById('alertBox').style.display = 'block';
            document.getElementById('alertBox').innerHTML = `‚ö†Ô∏è ${alertRow[3]}`;
            // ‡¶∞‡ßá‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø‡¶ï‡¶∂‡¶® ‡¶ü‡¶æ‡¶á‡¶Æ‡¶ü‡¶ø‡¶ï‡ßá ‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£ ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü ‡¶π‡¶ø‡¶∏‡ßá‡¶¨‡ßá ‡¶®‡¶ø‡¶ö‡ßç‡¶õ‡¶ø (‡¶Ø‡ßá‡¶Æ‡¶®: 12:00)
            activeRestriction = alertRow[2] ? alertRow[2].toString().trim() : null;
        }
    }

    function renderRoutine() {
        const year = document.getElementById('yearSelect').value;
        const list = document.getElementById('routineList');
        list.innerHTML = "";
        if (!year) return;

        const dayName = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"][new Date().getDay()];
        let currentDay = "";
        let isRestricted = false;
        
        const filtered = allData.routine.filter((row, index) => {
            if (index === 0) return false;
            if (row[0]) currentDay = row[0].trim();
            return currentDay === dayName && String(row[2]) === year;
        });

        filtered.forEach(row => {
            // ‡¶∞‡ßÅ‡¶ü‡¶ø‡¶®‡ßá‡¶∞ ‡¶∏‡¶Æ‡ßü (‡¶Ø‡ßá‡¶Æ‡¶®: 9:00-9:45 ‡¶•‡ßá‡¶ï‡ßá 9:00 ‡¶Ö‡¶Ç‡¶∂‡¶ü‡ßÅ‡¶ï‡ßÅ ‡¶®‡¶ø‡¶ö‡ßç‡¶õ‡¶ø)
            const classStart = row[1].split('-')[0].trim();

            // ‡¶Ø‡¶¶‡¶ø ‡¶∞‡ßÅ‡¶ü‡¶ø‡¶®‡ßá‡¶∞ ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏‡ßá‡¶∞ ‡¶∏‡¶Æ‡ßü ‡¶∞‡ßá‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø‡¶ï‡¶∂‡¶® ‡¶ü‡¶æ‡¶á‡¶Æ‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶Æ‡¶ø‡¶≤‡ßá ‡¶Ø‡¶æ‡ßü, ‡¶§‡¶¨‡ßá ‡¶≤‡¶ï ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶π‡¶¨‡ßá
            if (activeRestriction && classStart === activeRestriction) {
                isRestricted = true;
            }

            // ‡¶≤‡¶ï ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶π‡ßü‡ßá ‡¶ó‡ßá‡¶≤‡ßá ‡¶Ü‡¶∞ ‡¶ï‡ßã‡¶®‡ßã ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã ‡¶π‡¶¨‡ßá ‡¶®‡¶æ
            if (isRestricted) return;

            list.innerHTML += `
                <div class="card">
                    <span class="time">‚è∞ ‡¶∏‡¶Æ‡ßü: ${row[1]}</span>
                    <div class="subject">üìö ${row[3] || 'General Class'}</div>
                    <div class="teacher">üë®‚Äçüè´ ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶ï: ${row[4] || 'N/A'}</div>
                </div>`;
        });

        if (list.innerHTML === "") {
            list.innerHTML = `<p style="text-align:center; color:#666;">${activeRestriction ? "‡¶Ü‡¶ú ‡¶è‡¶á ‡¶∏‡¶Æ‡ßü‡ßá‡¶∞ ‡¶™‡¶∞‡ßá‡¶∞ ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏‡¶ó‡ßÅ‡¶≤‡ßã ‡¶∏‡ßç‡¶•‡¶ó‡¶ø‡¶§‡•§" : "‡¶Ü‡¶ú ‡¶ï‡ßã‡¶®‡ßã ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏ ‡¶®‡ßá‡¶á‡•§"}</p>`;
        }
    }

    fetchData();
</script>
</body>
</html>
